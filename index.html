<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <!-- MAIN STYLES -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/firefly.css">
</head>

<body>

<!-- ============================================================
     LAYER 0 — BACKGROUND LAYERS
============================================================ -->

<div id="background-layer" class="background-layer"></div>
<div id="firefly-layer" class="firefly-layer"></div>

<audio id="copy-sfx" src="styles/assets/copy.mp3"></audio>

<script>
/* Fireflies */
const fireflyLayer = document.getElementById("firefly-layer");
for (let i = 0; i < 15; i++) {
    const f = document.createElement("div");
    f.classList.add("firefly");
    fireflyLayer.appendChild(f);
}
</script>


<!-- ============================================================
     LAYER 1 — TOP UI (HEADER + TAB BAR + TOOLTIP)
============================================================ -->

<div id="top-ui">

    <!-- HEADER -->
    <header class="header-container">
        <div class="header-icons header-icons-left">
            <a href="#" data-target="about-section" class="header-text-link">About</a>
            <a href="#" data-target="tip-section" class="header-text-link">Tip</a>
        </div>

        <h1 class="header-title">BSVhub.app</h1>

        <div class="header-icons header-icons-right">
            <a href="#" data-target="contact-section" class="header-text-link">Contact</a>
        </div>
    </header>


    <!-- TAB BAR -->
    <nav class="tab-bar">

        <button class="tab-btn" data-target="explorers">Block Explorers</button>
        <button class="tab-btn" data-target="wallets">Wallets</button>
        <button class="tab-btn" data-target="social">Social</button>
        <button class="tab-btn" data-target="apps">Apps</button>
        <button class="tab-btn" data-target="bsv">BSV Main Sites</button>
        <button class="tab-btn" data-target="docs">Docs</button>
        <button class="tab-btn" data-target="mining">Mining</button>
        <button class="tab-btn" data-target="exchange">Buy BSV</button>
        <button class="tab-btn" data-target="new">New</button>

        <div class="search-container">
            <input id="search-box" type="text" placeholder="search here">
        </div>

    </nav>

    <!-- TOOLTIP BAR -->
    <div id="tooltip-display"></div>

</div>



<!-- ============================================================
     LAYER 2 — CONTENT AREA (SCROLLABLE)
============================================================ -->

<main id="content-area">

    <!-- SEARCH RESULTS -->
    <section id="search-results" class="tab-content"></section>

    <!-- STATIC ABOUT SECTION -->
    <section id="about-section" class="tab-content header-tab-content">
        <div class="header-tab-text">
            Number of visitors:
            <br><br>

            <div id="visit-counter" style="pointer-events:none;">
                <script src="https://counter.websiteout.com/js/7/6/0/0"></script>
            </div>

            <br><br>
            Last update: 29th Nov. 2025
        </div>
    </section>

</main>



<!-- ============================================================
     1 — TOOLTIP SYSTEM (double-RAF + sticky-start)
     - Ensures tooltip expansion has started before we measure.
     - Triggers positionContent which now uses sticky rules.
   ============================================================ -->
<script>
const tooltipBox = document.getElementById("tooltip-display");

function bindTooltips() {
    document.querySelectorAll(".icon-wrapper[data-tooltip]").forEach(wrapper => {

        const text = wrapper.dataset.tooltip;

        wrapper.addEventListener("mouseenter", () => {
            // set tooltip text (starts CSS transition)
            setTooltipText(text);

            // Double RAF to allow CSS transition to start and layout to update
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    // compute and apply sticky shift (may increase existing sticky)
                    positionContent(wrapper);
                });
            });
        });

        wrapper.addEventListener("mouseleave", () => {
            // collapse tooltip
            setTooltipText("");

            // On collapse we wait until transition end to fully reset (handled in Section 8)
            // but recalc layout after collapse animation starts so UI feels responsive
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    positionContent(null);
                });
            });
        });
    });
}

// Call after DOM injection of icons
// bindTooltips();
</script>





<!-- ============================================================
     JS SECTION 2 — BACKGROUND GRADIENT
============================================================ -->

<script>
const colors = ["#555555", "#6a0dad", "#001f54"];
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
document.getElementById("background-layer").style.background =
  `linear-gradient(135deg, ${shuffle([...colors]).join(', ')})`;
</script>


<!--=========================================================
     JS SECTION 3 — TAB SYSTEM  (WITH SEARCH RESET ADDED)
============================================================ -->
<script>
const tabButtons = document.querySelectorAll('.tab-btn');
const headerLinks = document.querySelectorAll('.header-text-link');

/* ------------------------------------------------------------
   RESET SEARCH
   - clears input
   - hides search results section
   - resets layout
------------------------------------------------------------ */
function resetSearch() {
    const resultSec = document.getElementById("search-results");
    const searchBox = document.getElementById("search-box");

    searchBox.value = "";                 // clear input
    resultSec.innerHTML = "";             // clear search results
    resultSec.classList.remove("active"); // hide search results

    // DEACTIVATE ALL TAB CONTENTS
    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );

    requestAnimationFrame(() => {
        if (typeof positionContent === "function") {
            positionContent(null);        // fix layout
        }
    });
}


/* ------------------------------------------------------------
   ACTIVATE TAB
------------------------------------------------------------ */
function activateTab(targetId, source) {
    tabButtons.forEach(b => b.classList.remove('active'));
    headerLinks.forEach(h => h.classList.remove('active'));

    if (source) source.classList.add('active');

    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );

    const sec = document.getElementById(targetId);
    if (sec) sec.classList.add('active');
}

/* ------------------------------------------------------------
   TAB BUTTON CLICK — WITH SEARCH RESET
------------------------------------------------------------ */
tabButtons.forEach(btn =>
    btn.addEventListener("click", () => {
        resetSearch();  // <-- NEW
        activateTab(btn.dataset.target, btn);
    })
);

/* ------------------------------------------------------------
   HEADER LINK CLICK — WITH SEARCH RESET
------------------------------------------------------------ */
headerLinks.forEach(link =>
    link.addEventListener("click", (e) => {
        e.preventDefault();
        resetSearch();  // <-- NEW
        activateTab(link.dataset.target, link);
    })
);

</script>



<script>
/* ============================================================
   4 — BASELINE CONTENT POSITIONING (NO HOVER SHIFTING)
   Keeps content-area placed directly below #top-ui.
   ============================================================ */

(function () {
    const content = document.getElementById("content-area");
    const topUI = document.getElementById("top-ui");

    // Reposition content-area directly under top UI (header + tabs + tooltip)
    function positionContent() {
        const baseTop = topUI.offsetHeight;
        content.style.top = `${baseTop}px`;
    }

    // Expose globally
    window.positionContent = positionContent;

    // Re-run on resize
    window.addEventListener("resize", positionContent);

    // Run once at load
    requestAnimationFrame(positionContent);
})();
</script>


<!-- ============================================================
     JS SECTION 5 — ICON TEXT AUTO-FIT
============================================================ -->

<!--script>
function adjustIconTextSmart() {
    document.querySelectorAll('.icon-wrapper').forEach(icon => {
        const t = icon.querySelector('.icon-text');
        t.style.whiteSpace = "nowrap";
        if (t.scrollWidth > icon.offsetWidth) {
            t.style.whiteSpace = "normal";
            t.style.maxWidth = "90%";
        }
    });
}
</script>



<!-- ============================================================
     JS SECTION 6 — JSON LOADER (FIXED & ROBUST)
     - builds sections
     - binds behaviors
     - positions content (double RAF)
     - auto-activates "new" tab or first tab fallback
============================================================ -->
<script>
fetch("list.json")
  .then(r => r.json())
  .then(data => {
    const container = document.getElementById("content-area");

    // Build sections
    Object.entries(data.sections).forEach(([id, section]) => {
      const sec = document.createElement("section");
      sec.id = id;
      sec.className = "tab-content";

      if (section.items) {
        const ul = document.createElement("ul");
        ul.className = "icon-grid";

        section.items.forEach(item => {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = item.href || "#";
          a.target = "_blank";

          const wrap = document.createElement("div");
          wrap.className = "icon-wrapper";
          if (item.tooltip) wrap.dataset.tooltip = item.tooltip;

          const img = document.createElement("img");
          img.src = item.img || "";
          img.alt = item.alt || "";

          const txt = document.createElement("div");
          txt.className = "icon-text";
          txt.textContent = item.text || "";

          wrap.appendChild(img);
          wrap.appendChild(txt);
          a.appendChild(wrap);
          li.appendChild(a);
          ul.appendChild(li);
        });

        sec.appendChild(ul);
      }

      if (section.html) sec.innerHTML = section.html;

      container.appendChild(sec);
    });

    // Bind behaviors
    bindTooltips();
    // adjustIconTextSmart(); // optional

    // Ensure tab buttons exist
    const tabButtons = document.querySelectorAll('.tab-btn');

    // Activate "new" tab or first tab
    const newBtn = document.querySelector('.tab-btn[data-target="new"]');
    const firstBtn = tabButtons[0];
    const targetBtn = newBtn || firstBtn;

    if (targetBtn) {
      // Use requestAnimationFrame to wait until DOM fully painted
      requestAnimationFrame(() => {
        activateTab(targetBtn.dataset.target, targetBtn);
      });
    }
  })
  .catch(err => console.error(err));

</script>

<!-- ============================================================
     JS SECTION 7 — SEARCH SYSTEM (SLIMMED & WORKING)
============================================================ -->
<script>
const searchBox = document.getElementById("search-box");
const resultSec = document.getElementById("search-results");
const excludedTabs = ["about-section","tip-section","info-section","contact-section"];

searchBox.addEventListener("input", () => {
    const q = searchBox.value.toLowerCase();

    // Clear previous search results
    resultSec.innerHTML = "";

    // If search is empty, hide results and restore nothing
    if (!q) {
        resultSec.classList.remove("active");
        return;
    }

    // DEACTIVATE CURRENT TAB AND TAB BUTTONS
    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );
    document.querySelectorAll('.tab-btn').forEach(btn =>
        btn.classList.remove('active')
    );

    const grid = document.createElement("ul");
    grid.className = "icon-grid";
    const found = new Set();

    const excludedTabs = ["about-section","tip-section","info-section","contact-section"];

    document.querySelectorAll('.tab-content').forEach(sec => {
        if (excludedTabs.includes(sec.id)) return;

        sec.querySelectorAll('.icon-wrapper').forEach(icon => {
            const txt = icon.querySelector('.icon-text').textContent.toLowerCase();
            const tip = (icon.dataset.tooltip || "").toLowerCase();

            if ((txt.includes(q) || tip.includes(q)) && !found.has(txt)) {
                grid.appendChild(icon.closest("li").cloneNode(true));
                found.add(txt);
            }
        });
    });

    if (found.size > 0) {
        resultSec.appendChild(grid);
        bindTooltips();
        resultSec.classList.add("active");
    } else {
        resultSec.classList.remove("active");
    }
});

</script>

<!-- ============================================================
     8 — TOOLTIP WRAP ANIMATION & TEXT SETTER (sync + double-RAF)
     ============================================================ -->
<script>
const tooltip = document.getElementById("tooltip-display");

function updateTooltipWrapAnimation() {
    tooltip.classList.toggle("expanded", tooltip.scrollHeight > 28);
}

function setTooltipText(text) {
    tooltip.innerHTML = text;

    // Update class immediately so CSS transition starts
    updateTooltipWrapAnimation();

    // Double RAF before measuring to allow layout to settle after CSS change
    requestAnimationFrame(() => {
        requestAnimationFrame(() => {
            // Let positioning logic run; it will use sticky rules
            // We call with null so baseline is applied but sticky may persist
            if (typeof positionContent === 'function') positionContent(null);
        });
    });
}
</script>




<!-- ============================================================
     JS SECTION 9 — COPY BUTTON SOUND
============================================================ -->

<script>
document.addEventListener("click", (e) => {
    if (e.target.id === "copy-tip-btn") {
        document.getElementById("copy-sfx").play();
    }
});
</script>



</body>
</html>
