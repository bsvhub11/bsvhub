<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/firefly.css">
</head>

<body>
<div class="background-layer"></div>
<div class="firefly-layer"></div>
<audio id="copy-sfx" src="styles/assets/copy.mp3"></audio>

<script>
  const fireflyContainer = document.querySelector('.firefly-layer');
  const quantity = 15;
  for (let i = 0; i < quantity; i++) {
    const firefly = document.createElement('div');
    firefly.classList.add('firefly');
    fireflyContainer.appendChild(firefly);
  }
</script>
<div id="ui-fixed-wrapper">

	<!-- HEADER -->
	<div class="header-container">
	  <div class="header-icons header-icons-left">
		<a href="#" data-target="about-section" class="header-text-link">About</a>
		<a href="#" data-target="tip-section" class="header-text-link">Tip</a>
	  </div>

	  <h1 class="header-title">BSVhub.app</h1>

	  <div class="header-icons header-icons-right">
		<!--a href="#" data-target="info-section" class="header-text-link">Info</a-->
		<a href="#" data-target="contact-section" class="header-text-link">Contact</a>
		
	  </div>
	</div>

	<!-- TAB BAR -->
	<div class="tab-bar">

		
				
		<!-- ORIGINAL TAB BUTTONS -->
		<button class="tab-btn" data-target="explorers">Block Explorers</button>
		<button class="tab-btn" data-target="wallets">Wallets</button>
		<button class="tab-btn" data-target="social">Social</button>
		<button class="tab-btn" data-target="apps">Apps</button>
		<button class="tab-btn" data-target="bsv">BSV Main Sites</button>
		<button class="tab-btn" data-target="docs">Docs</button>
		<button class="tab-btn" data-target="mining">Mining</button>
		<button class="tab-btn" data-target="exchange">Buy BSV</button>
		<button class="tab-btn" data-target="new">New</button>
		
		<!-- NEW â€” SEARCH BAR -->
		<div class="search-container">
    		<input 
        		id="search-box"
        		class="search-box"
        		type="text"
        		placeholder="search here"
    		>
		</div>
		
	</div>

	<div id="tooltip-display"></div>
</div>

<!-- JSON POPULATED CONTENT -->
<div id="content-area">
    
    <!-- Unified Search Result Section -->
    <section id="search-results" class="tab-content"></section>

    <!-- STATIC ABOUT SECTION (now part of HTML) -->
    <section id="about-section" class="tab-content header-tab-content">
		<div class="header-tab-text">
			Number of visitors:<br><br>

			<!-- BEGIN: visitor counter -->
			<div id="visit-counter" style="pointer-events: none;">
				<script type="text/javascript" src="https://counter.websiteout.com/js/22/6/0/0"></script>
			</div>
			<!-- END: visitor counter -->

			<br><br>
			Last update: 21th Nov. 2025
		</div>
	</section>



</div>

<script>
/* ============================================================
   1 â€” TOOLTIP SYSTEM (FIXED)
   ============================================================ */

const tooltipBox = document.getElementById("tooltip-display");

/* NEW â€” reusable tooltip binder for dynamic content */
function bindTooltips() {
    document.querySelectorAll(".icon-wrapper[data-tooltip]").forEach(icon => {
        const text = icon.dataset.tooltip;

        icon.addEventListener("mouseenter", () => {
			setTooltipText(text);
			positionContentBelowTooltip();
		});

		icon.addEventListener("mouseleave", () => {
			setTooltipText("");
			positionContentBelowTooltip();
		});

    });
}


/* ============================================================
   2 â€” BACKGROUND GRADIENT
   ============================================================ */
const colors = ["#555555", "#6a0dad", "#001f54"];

function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

const shuffled = shuffleArray([...colors]);
const gradient = `linear-gradient(135deg, ${shuffled[0]} 0%, ${shuffled[1]} 45%, ${shuffled[2]} 100%)`;
document.querySelector('.background-layer').style.background = gradient;


/* ============================================================
   3 â€” TAB SYSTEM (FIXED)
   ============================================================ */

const tabButtons = document.querySelectorAll('.tab-btn');
const headerLinks = document.querySelectorAll('.header-text-link');

/* FIX: re-query tab contents every time */
function activateTab(targetId, clickedElement = null) {
    
    tabButtons.forEach(btn => btn.classList.remove('active'));
    headerLinks.forEach(link => link.classList.remove('active'));

    if (clickedElement) clickedElement.classList.add('active');

    /* FIX: dynamically retrieve tab contents after JSON load */
    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );

    const target = document.getElementById(targetId);
    if (target) target.classList.add('active');
}

tabButtons.forEach(btn => {
    btn.addEventListener('click', () => activateTab(btn.dataset.target, btn));
});

headerLinks.forEach(link => {
    link.addEventListener('click', e => {
        e.preventDefault();
        activateTab(link.dataset.target, link);
    });
});


/* ============================================================
   4 â€” POSITIONING
   ============================================================ */
function positionContentBelowTooltip() {
    const tooltip = document.getElementById("tooltip-display");
    const content = document.getElementById("content-area");

    const rect = tooltip.getBoundingClientRect();
    const extraOffset = -20;

    content.style.top = `${rect.bottom + extraOffset}px`;
}

window.addEventListener("resize", positionContentBelowTooltip);


/* ============================================================
   5 â€” ICON TEXT
   ============================================================ */
function adjustIconTextSmart() {
    document.querySelectorAll('.icon-wrapper').forEach(icon => {
        const text = icon.querySelector('.icon-text');

        text.style.whiteSpace = "nowrap";
        text.style.maxWidth = "100%";

        if (text.scrollWidth > icon.offsetWidth) {
            text.style.whiteSpace = "normal";
            text.style.maxWidth = "90%";
        }
    });
}


/* ============================================================
   6 â€” JSON LOADER (FIXED)
   ============================================================ */
fetch("list.json")
    .then(r => r.json())
    .then(data => {
        const container = document.getElementById("content-area");

        Object.entries(data.sections).forEach(([id, section]) => {
            const sec = document.createElement("section");
            sec.id = id;

            // ðŸ”¹ FIX: Ensure all sections get the 'tab-content' class
            // This is crucial â€” activateTab() relies on .tab-content
            sec.className = "tab-content " + (section.class || "");

            /* Case A: icon-grid sections */
            if (section.items) {

                // === NEW: SORT ITEMS ALPHABETICALLY BY NAME ===
                section.items.sort((a, b) => a.text.localeCompare(b.text));

                const ul = document.createElement("ul");
                ul.className = "icon-grid";

                section.items.forEach(item => {
                    const li = document.createElement("li");
                    const a = document.createElement("a");
                    a.href = item.href;
                    a.target = "_blank";

                    const wrap = document.createElement("div");
                    wrap.className = "icon-wrapper";
                    wrap.dataset.tooltip = item.tooltip;

                    const img = document.createElement("img");
                    img.className = "hover-enlarge";
                    img.src = item.img;
                    if (item.width) img.width = item.width;
                    img.alt = item.alt;

                    const text = document.createElement("div");
                    text.className = "icon-text";
                    text.textContent = item.text;

                    wrap.appendChild(img);
                    wrap.appendChild(text);
                    a.appendChild(wrap);
                    li.appendChild(a);
                    ul.appendChild(li);
                });

                sec.appendChild(ul);
            }

            /* Case B: header-tab-content sections */
            if (section.html) {
                sec.innerHTML = section.html;
            }

            container.appendChild(sec);
        });

        // ðŸ”¹ Re-bind tooltips, adjust text, and position content after sections are injected
        bindTooltips();
        adjustIconTextSmart();
        positionContentBelowTooltip();
    });

// Copy tip address button
document.addEventListener("click", (e) => {
    if (e.target.id === "copy-tip-btn") {
        const addr = document.getElementById("tip-address").textContent.trim();
        navigator.clipboard.writeText(addr).then(() => {
            e.target.textContent = "Copied!";
            setTimeout(() => (e.target.textContent = "Copy"), 1200);
        });
    }
});



/* ============================================================
7 â€” SEARCH SYSTEM (GLOBAL SEARCH WITH DYNAMIC TAB HIGHLIGHT)
============================================================ */
const searchBox = document.getElementById("search-box");

// Tabs we do NOT want to filter â€” these are header-only sections
const excludedTabs = [
    "about-section",
    "tip-section",
    "info-section",
    "contact-section"
];

searchBox.addEventListener("input", () => {
    const query = searchBox.value.toLowerCase();
    const searchSection = document.getElementById("search-results");

    // ALWAYS clear previous results
    searchSection.innerHTML = "";

    /* ------------------------------------------------------------
       A â€” Empty search â†’ restore normal tab view
       ------------------------------------------------------------ */
    if (!query) {

        // Hide search result panel
        searchSection.classList.remove("active");

        // Restore default tab ("new")
        activateTab("new", document.querySelector('.tab-btn[data-target="new"]'));

        return; // END â€” nothing else happens when search is empty
    }

    /* ------------------------------------------------------------
       B â€” Searching â†’ disable all normal tabs
       ------------------------------------------------------------ */
    document.querySelectorAll(".tab-content").forEach(sec => {
        if (sec !== searchSection) sec.classList.remove("active");
    });

    // Create the unified results grid
    let resultGrid = document.createElement("ul");
    resultGrid.className = "icon-grid";

    let found = 0;
    const seenTexts = new Set(); // prevent duplicates

    /* ------------------------------------------------------------
       C â€” Scan ALL sections (except excluded ones)
       ------------------------------------------------------------ */
    document.querySelectorAll(".tab-content").forEach(section => {
        if (excludedTabs.includes(section.id)) return;

        const lis = section.querySelectorAll("li");
        lis.forEach(li => {

            const wrapper = li.querySelector(".icon-wrapper");
            if (!wrapper) return;

            const txt = wrapper.querySelector(".icon-text").textContent.toLowerCase();
            const tip = wrapper.dataset.tooltip.toLowerCase();

            const match = txt.includes(query) || tip.includes(query);

            if (match && !seenTexts.has(txt)) {
                // Clone so we don't remove original from its tab
                resultGrid.appendChild(li.cloneNode(true));
                seenTexts.add(txt);
                found++;
            }
        });
    });

    /* ------------------------------------------------------------
       D â€” Display results or hide the search tab
       ------------------------------------------------------------ */
    if (found > 0) {

        // Inject the unified results grid
        searchSection.appendChild(resultGrid);

        // ðŸ”¹ Re-bind tooltips for cloned search items (required!)
        bindTooltips();

        // Show search results section
        searchSection.classList.add("active");

        // Remove active highlight from all tabs
        tabButtons.forEach(btn => btn.classList.remove("active"));

    } else {

        // No matches â†’ hide search results section
        searchSection.classList.remove("active");
    }
});

/* ============================================================
8 â€” TOOLTIP wrapping annimation
============================================================ */

const tooltip = document.getElementById("tooltip-display");

function updateTooltipWrapAnimation() {
    // If content is taller than one line â†’ we are wrapping
    if (tooltip.scrollHeight > 30) {
        tooltip.classList.add("expanded");
    } else {
        tooltip.classList.remove("expanded");
    }
}

// Recalculate on new tooltip text
function setTooltipText(text) {
    tooltip.innerHTML = text;
    requestAnimationFrame(() => updateTooltipWrapAnimation());
}

// Optional: also recalc when window size changes
window.addEventListener("resize", updateTooltipWrapAnimation);

</script>

<script>
document.addEventListener("click", e =>
  e.target.id === "copy-tip-btn"
    ? document.getElementById("copy-sfx").play()
    : 0
);
</script>

</body>
</html>
