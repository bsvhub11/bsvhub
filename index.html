<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="preload" href="assets/facon.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/firefly.css">
</head>

<body>
<div class="background-layer"></div>
<div class="firefly-layer"></div>

<script>
  const fireflyContainer = document.querySelector('.firefly-layer');
  const quantity = 15;
  for (let i = 0; i < quantity; i++) {
    const firefly = document.createElement('div');
    firefly.classList.add('firefly');
    fireflyContainer.appendChild(firefly);
  }
</script>

<div id="ui-fixed-wrapper">

	<!-- HEADER -->
	<div class="header-container">
	  <div class="header-icons header-icons-left">
		<a href="#" data-target="about-section" class="header-text-link">About</a>
		<a href="#" data-target="tip-section" class="header-text-link">Tip</a>
	  </div>

	  <h1 class="header-title">BSVhub.app</h1>

	  <div class="header-icons header-icons-right">
		<a href="#" data-target="info-section" class="header-text-link">Info</a>
		<a href="#" data-target="contact-section" class="header-text-link">Contact</a>
	  </div>
	</div>

	<!-- TAB BAR -->
	<div class="tab-bar">
	  	<button class="tab-btn" data-target="explorers">Block Explorers</button>
		<button class="tab-btn" data-target="wallets">Wallets</button>
		<button class="tab-btn" data-target="social">Social</button>
		<button class="tab-btn" data-target="apps">Apps</button>
		<button class="tab-btn" data-target="bsv">BSV Main Sites</button>
		<button class="tab-btn" data-target="docs">Docs</button>
		<button class="tab-btn" data-target="mining">Mining</button>
		<button class="tab-btn" data-target="exchange">Buy BSV</button>
		<button class="tab-btn" data-target="new">New</button>
	</div>

	<div id="tooltip-display"></div>
</div>

<!-- JSON POPULATED CONTENT -->
<div id="content-area"></div>


<!-- ============================================================
   EXISTING JS (MODIFIED ONLY WHEN REQUIRED)
   ============================================================ -->
<script>
/* ============================================================
   1 — TOOLTIP SYSTEM (FIXED)
   ============================================================ */

const tooltipBox = document.getElementById("tooltip-display");

/* NEW — reusable tooltip binder for dynamic content */
function bindTooltips() {
    document.querySelectorAll(".icon-wrapper[data-tooltip]").forEach(icon => {
        const text = icon.dataset.tooltip;

        icon.addEventListener("mouseenter", () => {
            tooltipBox.textContent = text;
            positionContentBelowTooltip();
        });

        icon.addEventListener("mouseleave", () => {
            tooltipBox.textContent = "";
            positionContentBelowTooltip();
        });
    });
}


/* ============================================================
   2 — BACKGROUND GRADIENT
   ============================================================ */
const colors = ["#555555", "#6a0dad", "#001f54"];

function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

const shuffled = shuffleArray([...colors]);
const gradient = `linear-gradient(135deg, ${shuffled[0]} 0%, ${shuffled[1]} 45%, ${shuffled[2]} 100%)`;
document.querySelector('.background-layer').style.background = gradient;


/* ============================================================
   3 — TAB SYSTEM (FIXED)
   ============================================================ */

const tabButtons = document.querySelectorAll('.tab-btn');
const headerLinks = document.querySelectorAll('.header-text-link');

const clickSound = new Audio('assets/sounds/tab-click.mp3');
clickSound.volume = 0.3;

/* FIX: re-query tab contents every time */
function activateTab(targetId, clickedElement = null) {
    clickSound.currentTime = 0;
    clickSound.play().catch(() => {});

    tabButtons.forEach(btn => btn.classList.remove('active'));
    headerLinks.forEach(link => link.classList.remove('active'));

    if (clickedElement) clickedElement.classList.add('active');

    /* FIX: dynamically retrieve tab contents after JSON load */
    document.querySelectorAll('.tab-content').forEach(sec =>
        sec.classList.remove('active')
    );

    const target = document.getElementById(targetId);
    if (target) target.classList.add('active');
}

tabButtons.forEach(btn => {
    btn.addEventListener('click', () => activateTab(btn.dataset.target, btn));
});

headerLinks.forEach(link => {
    link.addEventListener('click', e => {
        e.preventDefault();
        activateTab(link.dataset.target, link);
    });
});


/* ============================================================
   4 — POSITIONING
   ============================================================ */
function positionContentBelowTooltip() {
    const tooltip = document.getElementById("tooltip-display");
    const content = document.getElementById("content-area");

    const rect = tooltip.getBoundingClientRect();
    const extraOffset = -20;

    content.style.top = `${rect.bottom + extraOffset}px`;
}

window.addEventListener("resize", positionContentBelowTooltip);


/* ============================================================
   5 — ICON TEXT
   ============================================================ */
function adjustIconTextSmart() {
    document.querySelectorAll('.icon-wrapper').forEach(icon => {
        const text = icon.querySelector('.icon-text');

        text.style.whiteSpace = "nowrap";
        text.style.maxWidth = "100%";

        if (text.scrollWidth > icon.offsetWidth) {
            text.style.whiteSpace = "normal";
            text.style.maxWidth = "90%";
        }
    });
}


/* ============================================================
   6 — JSON LOADER (FIXED)
   ============================================================ */
fetch("list.json")
    .then(r => r.json())
    .then(data => {
        const container = document.getElementById("content-area");

        Object.entries(data.sections).forEach(([id, section]) => {
            const sec = document.createElement("section");
            sec.id = id;
            sec.className = section.class;

            /* Case A: icon-grid sections */
			if (section.items) {

				// === NEW: SORT ITEMS ALPHABETICALLY BY NAME ===
				section.items.sort((a, b) => a.text.localeCompare(b.text));

				const ul = document.createElement("ul");
				ul.className = "icon-grid";

				section.items.forEach(item => {
					const li = document.createElement("li");
					const a = document.createElement("a");
					a.href = item.href;
					a.target = "_blank";

					const wrap = document.createElement("div");
					wrap.className = "icon-wrapper";
					wrap.dataset.tooltip = item.tooltip;

					const img = document.createElement("img");
					img.className = "hover-enlarge";
					img.src = item.img;
					if (item.width) img.width = item.width;
					img.alt = item.alt;

					const text = document.createElement("div");
					text.className = "icon-text";
					text.textContent = item.text;

					wrap.appendChild(img);
					wrap.appendChild(text);
					a.appendChild(wrap);
					li.appendChild(a);
					ul.appendChild(li);
				});

				sec.appendChild(ul);
			}


            /* Case B: header-tab-content sections */
            if (section.html) {
                sec.innerHTML = section.html;
            }

            container.appendChild(sec);
        });

        /* re-bind capabilities AFTER injection */
        bindTooltips();
        adjustIconTextSmart();
        positionContentBelowTooltip();

        /* initial tab */
        activateTab("explorers", document.querySelector('.tab-btn[data-target="explorers"]'));
    });
</script>

</body>
</html>
